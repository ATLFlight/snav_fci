<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Qualcomm Navigator Flight Control Interface: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Qualcomm Navigator Flight Control Interface
   &#160;<span id="projectnumber">2.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Qualcomm Navigator Flight Control Interface Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Table of Contents</h2>
<ol type="1">
<li><a href="#introduction">Introduction</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#version-compatibility">Version Compatibility</a></li>
<li><a class="el" href="md__c_h_a_n_g_e_l_o_g.html">Changelog</a></li>
<li><a href="#cloning-and-building-the-code">Cloning and building the code</a></li>
<li><a href="#running-the-examples">Running the examples</a></li>
<li><a href="#documentation">Documentation</a></li>
<li><a href="#faq">FAQ</a></li>
</ol>
<h2>Introduction</h2>
<p>Qualcomm Navigator<sup>TM</sup> is a flight controller that runs on the Qualcomm Flight<sup>TM</sup> platform. Detailed information about its capabilities can be found on the <a href="https://developer.qualcomm.com/hardware/qualcomm-flight/qualcomm-navigator">Qualcomm Developer Network site</a>.</p>
<p><a href="https://github.com/ATLFlight/snav_fci">Qualcomm Navigator Flight Control Interface</a> is an example of an abstraction layer between the Qualcomm Navigator API and higher-level programs. It is intended to isolate application developers from certain low-level details of the Qualcomm Navigator API.</p>
<p>To get started with the documentation, see <a href="https://atlflight.github.io/snav_fci/classsnav__fci_1_1_flight_control_interface.html">snav_fci::FlightControlInterface</a>.</p>
<p>Several examples are provided to demonstrate how to use FlightControlInterface:</p>
<ul>
<li><a href="https://github.com/ATLFlight/snav_fci/blob/master/examples/hello_snav.cpp">hello_snav.cpp</a></li>
<li><a href="https://github.com/ATLFlight/snav_fci/blob/master/examples/basic_waypoint_example.cpp">basic_waypoint_example.cpp</a></li>
<li><a href="https://github.com/ATLFlight/snav_fci/blob/master/examples/multithreaded_waypoint_example.cpp">multithreaded_waypoint_example.cpp</a></li>
<li><a href="https://github.com/ATLFlight/snav_fci/blob/master/examples/orbit_example.cpp">orbit_example.cpp</a></li>
<li><a href="https://github.com/ATLFlight/snav_fci/blob/master/examples/nonblocking_trajectory_example.cpp">nonblocking_trajectory_example.cpp</a></li>
</ul>
<h2>Prerequisites</h2>
<h3>Hardware</h3>
<p>This example requires the following hardware:</p>
<ul>
<li><a href="https://shop.intrinsyc.com/collections/product-development-kits/products/qualcomm-snapdragon-flight-sbc">Qualcomm Flight Kit</a></li>
<li><a href="https://shop.intrinsyc.com/collections/dragonboard-accessories/products/qualcomm-electronic-speed-control-board">Qualcomm Electronic Speed Control (ESC) board</a></li>
<li>Drone frame, motors, and propellers; such as the <a href="https://worldsway.com/product/dragon-drone-development-kit/">Dragon Drone Development Kit</a></li>
</ul>
<p>Note that if you're using the Dragon DDK, a URDF ros package is available at: <a href="https://github.com/ATLFlight/dragon_ddk_description">dragon_ddk_description</a></p>
<h3>Software</h3>
<p>This example requires the following software:</p>
<ul>
<li><a href="https://support.intrinsyc.com/attachments/download/1597/Flight_3.1.3.1_JFlash.zip">Plaform Image from Intrynsic 3.1.3.1</a></li>
<li><a href="https://support.intrinsyc.com/attachments/download/1571/Flight_3.1.3.1_qcom_flight_controller_hexagon_sdk_add_on.zip">Platform Addon from Intrynsic 3.1.3.1</a></li>
<li><a href="https://developer.qualcomm.com/download/qualcomm-flight/navigator-v1.2.58.deb">Qualcomm Navigator Flight Controller SDK 1.2.58</a></li>
<li><a href="https://developer.qualcomm.com/download/machine-vision/machine-vision-sdk-v1.1.8.deb">Qualcomm Machine Vision SDK 1.1.8</a></li>
<li><a href="https://developer.qualcomm.com/download/qualcomm-flight/navigator-controller-esc-firmware-v1.2.0">Qualcomm ESC Firmware 1.2.0</a></li>
<li>CMake: install on target with <code>sudo apt-get install cmake</code></li>
<li>Eigen: install on target with <code>sudo apt-get install libeigen3-dev</code></li>
</ul>
<h2>Version Compatibility</h2>
<p>The table below summarizes what versions of Qualcomm Navigator are compatible with a given release of Flight Control Interface.</p>
<table class="doxtable">
<tr>
<th>Flight Control Interface Version </th><th>Qualcomm Navigator Version  </th></tr>
<tr>
<td>v2.0 </td><td>&gt;= v1.2.58 </td></tr>
<tr>
<td>v1.0 </td><td>&gt;= v1.2.53.1 </td></tr>
</table>
<h2>Cloning and building the code</h2>
<p>These instructions assume that your Qualcomm Flight board is connected to the internet, but, alternatively, you can clone this repo on an internet-connected computer and then push the files to your Qualcomm Flight board. These instructions also assume that the compilation is done on the Qualcomm Flight board.</p>
<h3>Clone this repo</h3>
<pre class="fragment">adb shell
cd /home/linaro
git clone https://github.com/ATLFlight/snav_fci.git
</pre><h3>Build the code</h3>
<pre class="fragment">cd snav_fci
mkdir build
cd build
cmake ..
make -j4
</pre><p>A library called <code>libsnav_fci.so</code> is built and put in the <code>lib</code> directory. Examples appear in the <code>bin</code> directory.</p>
<h2>Running the examples</h2>
<h3>Running Qualcomm Navigator simulator</h3>
<p>It is a good idea to test the examples in simulation before attempting any real flights. In general, this is a powerful way to test API programs without risking damage to any vehicles or the environment that could be caused in a real flight test. To do this, run <code>snav</code> in simulation mode: </p>
<pre class="fragment">sudo stop snav
sudo snav -w 1000
</pre><p>Although the motors do not spin in simulation mode, it is still prudent to remove the propellers while doing bench-top testing to avoid accidents.</p>
<h3>Test communication with Qualcomm Navigator</h3>
<p>From another shell, run the <code>hello_snav</code> example to test whether or not you are able to communicate with Qualcomm Navigator. </p>
<pre class="fragment">cd /home/linaro/snav_fci/build/bin
./hello_snav
</pre><p>You should see a message print out about successfully connecting to Qualcomm Navigator, and, if you have ESCs and motors connected, you should observe the status LEDs changing color and hear beeps indicating that Qualcomm Navigator started receiving commands.</p>
<p>For example, here is the output from a successful run (output is identical for both sim and non-sim): </p>
<pre class="fragment">linaro@linaro-developer:~/snav_fci/build/bin$ ./hello_snav
The apps &lt;--&gt; dsp offset = [1513353394762546617 ](ns) Apps ClockType[CLOCK_REALTIME]
[INFO] Launched tx thread (id: 3020944384)
[INFO] Launched rx thread (id: 3012555776)
Successfully connected to Qualcomm Navigator
[INFO] tx thread terminated normally
[INFO] rx thread terminated normally
</pre><p>Running this example successfully confirms that the flight stack is running normally and is accepting API commands. This is a good sanity test of your installation of Qualcomm Navigator and Flight Control Interface.</p>
<h3>Test example programs in simulation with snav_inspector</h3>
<p>With Qualcomm Navigator running in simulation mode, you can run any of the examples and observe the live simulated results using <code>snav_inspector</code>, a tool included in the Qualcomm Navigator package. For more information on how to use this tool, please refer to the <a href="https://developer.qualcomm.com/hardware/qualcomm-flight/qualcomm-navigator/tools">Qualcomm Navigator User Guide</a>.</p>
<p>For example, run the <code>basic_waypoint_example</code> program and observe the <code>pos_vel</code> group in <code>snav_inspector</code>. You should observe the <code>pos_vel.position_estimated</code> field tracking the <code>pos_vel.position_desired</code> field as the simulated vehicle executes the waypoint mission.</p>
<h3>Visualize simulated flight using ROS and rviz</h3>
<p>You can also test the example programs by visualizing the simulated flight in <code>rviz</code> using ROS. You can use <code>snav_ros</code> to accomplish this. Follow the instructions in the <a href="https://github.com/ATLFlight/snav_ros">snav_ros</a> https://github.com/ATLFlight/snav_ros/blob/master/README.md "README" to get up and running.</p>
<h3>Real flight test</h3>
<p>Once you are confident that the example programs are working properly in simulation, you can perform a real flight test. Kill the <code>snav</code> simulator and start <code>snav</code> normally with the <code>start snav</code> command.</p>
<p>Before running any of the programs, place the vehicle on flat ground that has plenty of visual texture. Make sure there is plenty of open space in all directions. If you have a Spektrum RC, be prepared to take over in the event of an anomaly.</p>
<h2>Documentation</h2>
<h3>Access the docs</h3>
<p>Doxygen documentation for the most recent release is available at <a href="https://atlflight.github.io/snav_fci/">https://atlflight.github.io/snav_fci/</a></p>
<h3>Generating the docs</h3>
<p>You can generate the documentation yourself as follows: </p>
<pre class="fragment">cd /home/linaro/snav_fci
doxygen Doxyfile
</pre><p>Autogenerated HTML files are put in the <code>docs</code> directory and can be viewed using a web browser. Simply open <code>index.html</code> in a browser to get started.</p>
<h2>FAQ</h2>
<h3>I am getting an error message about not being able to initialize SnavCachedData</h3>
<pre class="fragment">Update checksum_failure. [f0eb75d8,033e2d1a] Possible RPC issue.
[ERROR] snav_fci::FlightControlInterface::FlightControlInterface(const snav_fci::FlightControlInterface::Permissions&amp;)
terminate called after throwing an instance of 'std::runtime_error'
  what():  could not init SnavCachedData
Aborted
</pre><p>This error message usually indicates that Qualcomm Navigator is not actively running. Start Qualcomm Navigator using the <code>start snav</code> command for normal operation or the <code>snav -w</code> command for simulation and then rerun the program.</p>
<h3>I, like Ricky Bobby, wanna go fast</h3>
<p>Qualcomm Navigator has a number of parameters that directly and indirectly affect the maximum attainable velocity and acceleration. These parameters are set relatively conservatively by default. If you are interested in high-speed, aggressive trajectory-following, you may wish to adjust these parameters in order to reach higher velocities and accelerations.</p>
<p><code>SN_VIO_POS_HOLD_MODE</code> is the only mode supported when using the trajectory-tracking input, so only parameters relevant to that use case are discussed here. However, similar parameters exist for other modes and can be adjusted for faster flight when using the RC command input. Refer to the Qualcomm Navigator User Guide for detailed documentation on parameters.</p>
<p>The <code>vio_mode_xy_gain</code> and the <code>height_control_z_vel_gain</code> parameters in the <code>input_interpreter_params</code> group dictate the maximum attainable XY and Z speeds, respectively. The XY and Z velocity feedforward factors used in control can be set using the <code>velocity_ff_factor_vio</code> and <code>velocity_z_ff_factor_vio</code> parameters, respectively, in the <code>position_control_params</code> group, where a value of 0 eliminates the feedforward control and a value of 1 corresponds to full feedforward control.</p>
<p>Acceleration is slightly more complicated since it is related to the tilt angle and thrust-to-weight ratio of the vehicle. The maximum theoretical acceleration in the horizontal plane (Z component = 0) can be approximated as <code>gravity * tan(max_tilt_angle)</code> for idealized flight. The <code>max_vio_control_tilt_angle</code> parameter in the <code>position_control_params</code> group dictates the maximum tilt angle for VIO mode. The <code>max_acc_allowed</code> parameter in the <code>velocity_smoother_params</code> group specifies the maximum allowed acceleration to move the desired position in the XY plane.</p>
<p>Keep in mind that the vertical component of thrust is reduced when the tilt angle is non-zero, meaning that at some angle the vehicle is not able to maintain altitude due to its finite thrust. This critical angle may be approximated as <code>acos(1/(T/W))</code>, where <code>T/W</code> is the thrust-to-weight ratio of the vehicle. The thrust-to-weight ratio may be calculated by dividing the <code>max_thrust</code> parameter of the <code>rc_params</code> group by the <code>basethrust</code> parameter of the <code>position_control_params</code> group. Furthermore, keep in mind that in windy conditions a non-zero tilt angle is required to maintain zero acceleration.</p>
<p>The maximum theoretical vertical acceleration (XY components = 0) can be approximated as <code>((T/W)-1) * gravity</code>, where <code>T/W</code> is the thrust-to-weight ratio of the vehicle. However, this assumes zero tilt angle, so the actual achievable acceleration in Z is a function of the tilt angle at any given time.</p>
<p>Once the Qualcomm Navigator parameters have been updated, you should update the <code>max_allowed*</code> values in <a class="el" href="classsnav__fci_1_1_planner_config.html" title="Structure containing options for the Planner. ">snav_fci::PlannerConfig</a> to reflect these changes. Then, try increasing the <code>average_speed*</code> parameters in <a class="el" href="classsnav__fci_1_1_planner_config.html" title="Structure containing options for the Planner. ">snav_fci::PlannerConfig</a> to generate more aggressive trajectories if using TimestampStrategy::AVERAGE_SPEED; otherwise, manually adjust the timestamps to obtain the desired trajectory. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Apr 17 2018 13:20:04 for Qualcomm Navigator Flight Control Interface by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
